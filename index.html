<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ICT Pro Chart</title>

<style>
    body {
        margin: 0;
        background: #000;
        color: #fff;
        font-family: Arial;
    }

    .top {
        display: flex;
        justify-content: center;
        gap: 8px;
        padding: 10px;
        background: #111;
        flex-wrap: wrap;
    }

    button {
        background: #000;
        color: white;
        border: 1px solid #444;
        padding: 8px 14px;
        border-radius: 5px;
    }

    /* --- MAIN FIX --- */
    #tvchart {
        position: relative;
        width: 100%;
        height: calc(100vh - 70px);
        overflow: hidden;
    }

    #tradingview_chart {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }

    #overlayCanvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100% !important;
        height: 100% !important;
        pointer-events: none;
        z-index: 999999; /* overlay sabse upar */
        background: transparent;
    }
</style>
</head>

<body>

<div class="top">
    <button onclick="loadSymbol('XAUUSD')">XAU/USD</button>
    <button onclick="loadSymbol('XAGUSD')">XAG/USD</button>
    <button onclick="loadSymbol('BTCUSDT')">BTC</button>
    <button onclick="loadSymbol('ETHUSDT')">ETH</button>
</div>

<div id="tvchart">
    <div id="tradingview_chart"></div>
    <canvas id="overlayCanvas"></canvas>
</div>

<script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>

<script>

// -------- AUTO THEME --------
function autoTheme() {
    let h = new Date().getHours();
    return (h >= 7 && h <= 18) ? "light" : "dark";
}

let tvWidget = null;
let overlayCanvas = document.getElementById("overlayCanvas");
let ctx = overlayCanvas.getContext("2d");

// resize canvas automatically
function resizeCanvas() {
    overlayCanvas.width = overlayCanvas.clientWidth;
    overlayCanvas.height = overlayCanvas.clientHeight;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

// -------- LOAD SYMBOL ON TRADINGVIEW --------
function loadSymbol(symbol){
    let theme = autoTheme();

    // Clear previous chart
    document.getElementById("tradingview_chart").innerHTML = "";

    tvWidget = new TradingView.widget({
        "width": "100%",
        "height": "100%",
        "symbol": symbol,
        "interval": "15",
        "timezone": "Asia/Kolkata",
        "theme": theme,
        "style": "1",
        "locale": "en",
        "container_id": "tradingview_chart"
    });

    // After chart loads → call ICT data engine
    setTimeout(() => {
        fetchData(symbol);
    }, 3000);
}

// Default
loadSymbol("XAUUSD");

// -------- BASE FETCH FUNCTION (ICT logic PART 2 me add hoga) --------
async function fetchData(symbol){
    console.log("Data fetch ready:", symbol);

    clearOverlay();
    drawTestLine(); // test — overlay working check
}

// Clear overlay
function clearOverlay(){
    ctx.clearRect(0,0,overlayCanvas.width, overlayCanvas.height);
}

// TEMP TEST OVERLAY (green line)
function drawTestLine(){
    ctx.strokeStyle = "lime";
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(40,40);
    ctx.lineTo(250,250);
    ctx.stroke();
}

</script>
</body>
</html>
